<div class="container">
  <div class="row justify-content-center">
    <div class="col-12">
      <div class="d-flex justify-content-left align-items-start">
        <div class="mr-4">
          <h1><%= @bill.name %></h1>
          <p> <%= @bill.due_date %> </p>

        </div>
        <div>
          <%= link_to edit_flat_bill_path(@flat, @bill) do %>
            <i class="far fa-edit secondary-link"></i>
          <% end %>
          |
          <%= link_to flat_bill_path(@flat, @bill), method: :delete, data: { confirm: "Are you sure?" } do %>
            <i class="far fa-trash-alt secondary-link"></i>
          <% end %>
        </div>
      </div>
      <div class="d-flex justify-content-between align-items-center">
        <div>


        </div>
        <h2>Total <%= humanized_money_with_symbol(@bill.amount) %> </h2>
      </div>
      <div class="d-flex justify-content-between align-items-center">
        <%= link_to "< Go to Bills", flat_bills_path, class: "primary-link" %>
        <% if @bill.invoice.attached? %>
          <a href="<%= cl_image_path @bill.invoice.key %>" target="_blank">Invoice file</a>
        <% else %>
          <p class="mt-3">No invoice attached</p>
        <% end %>
      </div>
    </div>
  </div>
</div>

<div class="container">
  <div class="row justify-content-center">
    <div class="col-12">
      <% @bill.payments.order("created_at asc").each do |payment| %>
        <div class="<%= (payment.user_id == @bill.paying_user_id) || (payment.paid == true) ? 'expenses-card-white' : 'expenses-card-gray' %>">
          <div class="d-flex justify-content-between">
            <div class="d-flex align-items-center">
              <%= image_tag "victor-mendoza.jpg", class: "avatar-secondary-orange" %>
              <% if payment.user_id == @bill.paying_user_id %>
                <div class="text-left ">
                  <h3>  <%= payment.user.first_name %> </h3>
                  <p class="mb-0">First Payment</p>
                </div>
              <% else %>
                <h3> <%= payment.user.first_name %></h3>
              <% end %>
            </div>
              <% if (payment.paid == true) & (payment.user_id == @bill.paying_user_id) %>
                <div class="text-right">
                  <h2> <%= humanized_money_with_symbol(payment.amount) %> </h2>
                  <p class= "secondary-p">Has paid</p>
                </div>
              <% elsif (payment.paid == false) & (payment.user_id != @bill.paying_user_id) %>
                <div class="text-right">
                  <h2> <%= humanized_money_with_symbol(payment.amount) %> </h2>
                  <p class= "secondary-p">Has to pay to <%= @bill.paying_user.first_name %> </p>
                </div>
              <% else %>
                <div class="text-right">
                  <h2> <%= humanized_money_with_symbol(payment.amount) %> </h2>
                  <p class= "secondary-p">Has paid to <%= @bill.paying_user.first_name %></p>
                    <%= simple_form_for payment, class: "background-none", url: bill_payment_path(@bill, payment), method: :patch, remote: true do |f| %>
                    <%= f.input :paid, :as => :hidden, :input_html => { :value => :false } %>
                    <%= f.submit "Hasn't paid", class: "btn btn-link primary-link" %>
                <% end %>
                </div>
              <% end %>
            </div>
            <% if (payment.user_id != @bill.paying_user_id) & (payment.paid == false) %>
              <div class="d-flex justify-content-between align-items-center background-none">
                <%= link_to "Request Payment", flat_bills_path, class: "secondary-link" %>
                <%= simple_form_for payment, class: "background-none p-0", url: bill_payment_path(@bill, payment), method: :patch, remote: true do |f| %>
                  <%= f.input :paid, :as => :hidden, :input_html => { :value => :true } %>
                  <%= f.submit "Has paid", class: "btn shadow text-orange" %>
                <% end %>
              </div>
            <% end %>
          </div>
      <% end %>
  </div>
</div>

